- pipeline: Publish dev
  refs:
  - refs/heads/dev
  always_from_scratch: true
  auto_clear_cache: true
  fail_on_prepare_env_warning: true
  trigger_conditions:
  - trigger_condition: SUCCESS_PIPELINE
    project: ci-info
    pipeline: CI Integration Tests
  variables:
  - key: VERSION_BUMP_TYPE
  actions:
  - action: Select version bump
    type: WAIT_FOR_VARIABLES
    variables:
    - key: VERSION_BUMP_TYPE
      defaults: |-
        prerelease
        prepatch
        preminor
        premajor
  - action: Install packages
    type: BUILD
    docker_image_name: library/node
    docker_image_tag: 22
    execute_commands:
    - pnpm i
    setup_commands:
    - npm i pnpm -g
    volume_mappings:
    - /:/buddy-works/ci-info
    shell: BASH
  - action: Lint
    type: BUILD
    docker_image_name: library/node
    docker_image_tag: 22
    execute_commands:
    - pnpm lint
    - pnpm lint:types
    setup_commands:
    - npm i pnpm -g
    volume_mappings:
    - /:/buddy-works/ci-info
    shell: BASH
  - action: Build
    type: BUILD
    docker_image_name: library/node
    docker_image_tag: 22
    execute_commands:
    - pnpm build
    setup_commands:
    - npm i pnpm -g
    volume_mappings:
    - /:/buddy-works/ci-info
    shell: BASH
  - action: Bump version
    type: BUILD
    docker_image_name: library/node
    docker_image_tag: 22
    execute_commands:
    - git config user.email "ci@buddy.works"
    - git config user.name "Buddy CI"
    - "pnpm version --preid rc $VERSION_BUMP_TYPE -m \"chore(release): bump version to %s\""
    setup_commands:
    - npm i pnpm -g
    volume_mappings:
    - /:/buddy-works/ci-info
    shell: BASH
  - action: Git Push
    type: PUSH
    push_tags: true
    target_branch: $BUDDY_RUN_BRANCH
    targets:
    - project_repository
    isolated: true
  - action: Publish
    type: BUILD
    docker_image_name: library/node
    docker_image_tag: 22
    execute_commands:
    - pnpm publish --no-git-checks --access public --tag rc
    setup_commands:
    - npm i pnpm -g
    volume_mappings:
    - /:/buddy-works/ci-info
    shell: BASH
